#!/usr/bin/env bash

# Load the shell dotfiles, and then some:
# * ~/.extra can be used for other settings you don't want to commit.
for file in "${HOME}"/.{functions,aliases,extra}; do
	# shellcheck disable=SC1090
	[[ -f "${file}" ]] && . "${file}"
done

# If on a machine that doesn't have keychain, don't use it
if is_git_bash || ! does_program_exist keychain; then
	start_ssh_agent
else
	# If we're in a shell without a display manager, don't ask for a
	# password for the ssh key's to be added (unless we're in WSL, which is
	# fine).
	if is_login_shell && ! is_interactive_shell && ! is_wsl && ! is_ssh_session; then
		KEYCHAIN_NOASK='--noask'
	fi

	if ! start_ssh_keychain "${KEYCHAIN_NOASK}"; then
		keychain -q -k all
		start_ssh_keychain "${KEYCHAIN_NOASK}"
	fi
fi

# region: Completions

NODE_PATH='node'

if is_git_bash; then
	NODE_PATH='node.exe'
fi

# shellcheck disable=SC1090
does_program_exist "${NODE_PATH}" && . <(${NODE_PATH} --completion-bash)

does_program_exist thefuck && eval "$(thefuck --alias)"

# shellcheck disable=SC1090
does_program_exist pm2 && . <(pm2 completion)

# endregion

# broot
# shellcheck disable=SC1091
[[ -f "${HOME}"/.config/broot/launcher/bash/br ]] \
	&& . "${HOME}"/.config/broot/launcher/bash/br

# Make direnv silent by default. Doesn't work in `.exports` for some reason.
export DIRENV_LOG_FORMAT=""

# If set, bash/zsh does not overwrite an existing file with the >, >&, and <>
# redirection operators. This may be overridden when creating output files by
# using the redirection operator >| instead of >.
set -o noclobber
